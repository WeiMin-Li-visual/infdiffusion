<!DOCTYPE html>
<html style="height: 100%; initial-scale: 0.1">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>霍克斯过程模型</title>
    <script type="text/javascript" src="../static/layui/layui.js"></script>
    <link rel="stylesheet" href="../static/layui/css/layui.css" media="all">
    <style>
        #container{
            position:absolute;
            left:20%;
        }
        #control{
            margin-top:20px;
            width:20%;
            height:100%;
        }
    </style>
</head>
<body style="height: 100%; margin: 0">
<div id="container" style="height: 100%;width:80%;left: 2%"></div>


<script type="text/javascript" src="/static/js/echarts.js"></script>
<script type="text/javascript" src="/static/js/hawkesfunction.js"></script>
<script type="text/javascript">

    var dom = document.getElementById("container");
    var myChart = echarts.init(dom);
    // 首次显示加载动画
    //myChart.showLoading();
    var option;
    var graph = {{ graph_data | tojson }}//获取后端返回的图数据
    // 隐藏加载动画
    //myChart.hideLoading();
    graph = init_graph(graph);  //初始化图数据
    option = init_option(graph);//初始化属性
    myChart.setOption(option);//执行该语句就可以根据你设置的属性进行图的生成
    var predict_events = {{ predict_events | tojson }};
    var edge_record={{edge_record | tojson}};
    var numofevents={{numofevents|tojson}};
    predict_events = JSON.parse(predict_events);
    edge_record=JSON.parse(edge_record);
    numofevents=JSON.parse(numofevents);
    var indxi=-1
    var numofev=numofevents[0]

    var indxiedg=-1
    intervalNo = setInterval(() => {
        if (indxi<numofev) {
            indxi++;
            graph.nodes[predict_events[indxi][0]].category=1;
            graph.nodes[predict_events[indxi][0]].symbolSize=15;
            if(indxi==numofev){
                myChart.setOption({
                    title: {
                        text: '传播结束',
                        subtext: '当前从节点 ' + predict_events[indxi][1]+
                        ' 向节点 '+predict_events[indxi][0]+
                        ' 传播，时刻为 '+predict_events[indxi][2],
                    },
                    series: [
                        {
                            data: graph.nodes,
                            links: graph.links
                        }
                    ]
                });
            }
            else{
                myChart.setOption({
                    title: {
                       text: '传播过程',
                        subtext: '当前从节点 ' + predict_events[indxi][1]+
                        ' 向节点 '+predict_events[indxi][0]+
                        ' 传播，时刻为 '+predict_events[indxi][2],
                    },
                    series: [
                        {
                            data: graph.nodes,
                            links: graph.links
                        }
                    ]
                });
            }
        }
        if (indxiedg<numofev){
            indxiedg++;
            graph.links[edge_record[indxiedg]].lineStyle.width=6;
            graph.links[edge_record[indxiedg]].lineStyle.color=rgb(255,128,80);
            graph.links[edge_record[indxiedg]].itemStyle.normal.borderColor=rgba(240,128,128,0.8);
            myChart.setOption({
                series: [
                    {
                            data: graph.nodes,
                            links: graph.links
                    }
                ]
            });
        }
    },100);
    </script>
</body>
</html>